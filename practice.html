<!doctype html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; frame-src 'self' https://wokwi.com https://www.tinkercad.com; connect-src 'self' https://api.openai.com;">
    <link rel="stylesheet" href="/src/style.css" />
    <title>Maker's Tutor - 미리보기 실험실</title>
  </head>
  <body class="practice-page">
    <!-- API Key 상태 표시줄 (디버깅용) -->
    <div class="api-status-bar" id="apiStatusBar">
      <span id="apiStatusText">로딩 중...</span>
    </div>

    <!-- 네비게이션 바 -->
    <nav class="top-navigation" id="topNavigation">
      <a href="./index.html" class="nav-brand" title="Maker's Tutor 홈">
        🛠️ 💡 🚀 Maker's Tutor
      </a>
      <a href="./sensors.html" class="nav-item" data-stage="1">
        <span class="nav-number">1</span>
        <span class="nav-label">📚 센서 도서관</span>
      </a>
      <a href="./ideas.html" class="nav-item" data-stage="2">
        <span class="nav-number">2</span>
        <span class="nav-label">💡 아이디어 톡</span>
      </a>
      <a href="./practice.html" class="nav-item active" data-stage="3">
        <span class="nav-number">3</span>
        <span class="nav-label">🧪 미리보기 실험실</span>
      </a>
    </nav>
    
    <div id="app">
      <!-- 페이지 제목 -->
      <header class="practice-page-header">
        <h1 class="practice-page-title">🧪 미리보기 실험실</h1>
        <p class="practice-page-subtitle">가상 시뮬레이터에서 안전하게 실험해봐요!</p>
      </header>

      <!-- 도구 소개 섹션 (인포그래픽 스타일) -->
      <section class="tools-infographic-section">
        <div class="tools-infographic-container">
          <!-- 아두이노 카드 -->
          <div class="tool-infographic-card">
            <div class="tool-infographic-image">
              <img src="/sencors/arduino_uno.png" alt="아두이노" onerror="this.style.display='none';" />
            </div>
            <h3 class="tool-infographic-title">아두이노</h3>
            <p class="tool-infographic-desc">우리 프로젝트의 <strong>'두뇌'</strong> 역할을 해요! 여러분이 짠 코드를 기억하고 전기를 조절해서 센서들을 움직이게 만들죠.</p>
          </div>

          <!-- 브레드보드 카드 -->
          <div class="tool-infographic-card">
            <div class="tool-infographic-image">
              <img src="/sencors/breadboard.png" alt="브레드보드" onerror="this.style.display='none';" />
            </div>
            <h3 class="tool-infographic-title">브레드보드</h3>
            <p class="tool-infographic-desc">납땜 없이도 부품들을 서로 연결해주는 <strong>'연결 통로'</strong>예요. 전기가 잘 흐를 수 있게 부품들을 꽂아주기만 하면 돼요!</p>
          </div>

          <!-- Wokwi 카드 -->
          <div class="tool-infographic-card">
            <div class="tool-infographic-icon">🌐</div>
            <h3 class="tool-infographic-title">Wokwi</h3>
            <p class="tool-infographic-desc">실제 부품이 없어도 온라인에서 마음껏 실험해볼 수 있는 <strong>'가상 실험실'</strong>이에요. 실수로 연결을 잘못해도 망가지지 않으니 안심하고 도전하세요!</p>
          </div>
        </div>
      </section>

      <!-- 실험 미션 및 시뮬레이터 섹션 -->
      <section class="practice-mission-section">
        <!-- 미션 선택 탭 바 -->
        <div class="mission-tabs-container">
          <div class="mission-tabs" id="missionList">
            <!-- 미션 버튼들이 여기에 동적으로 추가됩니다 -->
          </div>
        </div>

        <!-- 미션 설명 및 시뮬레이터 -->
        <div class="mission-content-wrapper">
          <!-- 미션 설명창 -->
          <div class="mission-description-box">
            <h3 class="mission-description-title" id="guideTitle">미션을 선택해주세요</h3>
            <div class="mission-description-content">
              <div class="mission-description-item">
                <h4 class="mission-description-label">🎯 목표</h4>
                <p class="mission-description-text" id="guideObjective">왼쪽에서 미션을 선택하면 여기에 목표가 표시됩니다.</p>
              </div>
              <div class="mission-description-item">
                <h4 class="mission-description-label">💡 힌트</h4>
                <p class="mission-description-text" id="guideHint">힌트도 여기에 표시됩니다.</p>
              </div>
            </div>
          </div>

          <!-- Tinkercad 버튼 -->
          <div class="tinkercad-button-container">
            <a 
              href="https://www.tinkercad.com/circuits" 
              target="_blank" 
              rel="noopener noreferrer"
              class="tinkercad-link-button"
            >
              🚀 더 많은 센서는? 틴커캐드 열기
            </a>
          </div>

          <!-- Wokwi 시뮬레이터 -->
          <div class="simulator-wrapper">
            <iframe
              id="wokwiSimulator"
              src="https://wokwi.com/projects/450645630910703617"
              width="100%"
              height="800"
              style="border: none; border-radius: 16px;"
              title="Arduino Simulator"
              allow="autoplay; camera; microphone; serial"
              sandbox="allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts"
            ></iframe>
          </div>
        </div>
      </section>
    </div>

    <!-- 아두이노 전문가 챗봇 -->
    <div class="chatbot-container" id="chatbotContainer">
      <button class="chatbot-toggle" id="chatbotToggle" title="챗봇 열기">
        <span class="chatbot-icon">🤖</span>
      </button>
      
      <div class="chatbot-window hidden" id="chatbotWindow">
        <div class="chatbot-header">
          <h3 class="chatbot-title">🤖 아두이노 전문가</h3>
          <div class="chatbot-header-actions">
            <button class="chatbot-clear" id="chatbotClear" title="대화 지우기">🗑️</button>
            <button class="chatbot-close" id="chatbotClose" title="챗봇 닫기">✖</button>
          </div>
        </div>
        
        <div class="chatbot-messages" id="chatbotMessages">
          <!-- 메시지들이 여기에 동적으로 추가됩니다 -->
        </div>
        
        <div class="chatbot-input-container">
          <div class="chatbot-loading" id="chatbotLoading" style="display: none;">
            <span>생각 중...</span>
          </div>
          <div class="chatbot-input-wrapper">
            <input 
              type="text" 
              id="chatbotInput" 
              placeholder="회로 연결이나 코드 오류를 물어보세요..."
              autocomplete="off"
            />
            <button id="chatbotSendButton" type="button">전송</button>
          </div>
        </div>
      </div>
    </div>

    <script type="module" src="/src/practice.js"></script>
    <script>
      // 네비게이션 active 클래스 자동 처리
      document.addEventListener('DOMContentLoaded', () => {
        const navItems = document.querySelectorAll('.nav-item');
        const currentPath = window.location.pathname;
        
        navItems.forEach(item => {
          if (currentPath.includes('practice.html')) {
            if (item.getAttribute('href').includes('practice.html')) {
              item.classList.add('active');
            } else {
              item.classList.remove('active');
            }
          }
        });
      });
    </script>
  </body>
</html>
